<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTools Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body.resizing, body.resizing * { cursor: grabbing !important; }
        .bg-gif {
            background-image: url('gifs/a.gif');
            background-size: cover;
            background-position: center;
            filter: blur(20px) brightness(0.3);
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .sidebar-link { transition: all 0.2s; }
        .sidebar-link:hover {
            background: rgba(30, 64, 175, 0.1);
            border-left: 3px solid #1e40af;
            padding-left: 13px;
        }
        .sidebar-link.active {
            background: rgba(30, 64, 175, 0.2);
            border-left: 3px solid #1e40af;
            padding-left: 13px;
        }
        .no-select { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .resize-handle-n { cursor: n-resize; } .resize-handle-s { cursor: s-resize; }
        .resize-handle-e { cursor: e-resize; } .resize-handle-w { cursor: w-resize; }
        .resize-handle-ne { cursor: ne-resize; } .resize-handle-nw { cursor: nw-resize; }
        .resize-handle-se { cursor: se-resize; } .resize-handle-sw { cursor: sw-resize; }

        /* Estilos para To-Do List */
        .kanban-column.drag-over { background: rgba(30, 64, 175, 0.1); border-color: #1e40af; }
        .task-card {
            position: relative;
            cursor: move;
            transition: background-color 0.2s;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .task-card:hover { background-color: #1f2937; }
        .task-card .delete-btn {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            display: none;
            background-color: #4b5563;
            color: #d1d5db;
            border-radius: 9999px;
            width: 1.25rem;
            height: 1.25rem;
            line-height: 1.25rem;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
        }
        .task-card:hover .delete-btn { display: block; }
        .task-card .delete-btn:hover { background-color: #991b1b; }

        /* Estilos para o BBox Visualizer */
        .bbox-visualizer .image-display-box { height: 60vh; width: 100%; display: flex; align-items: center; justify-content: center; background-color: #111827; border: 1px solid #374151; border-radius: 0.25rem; }
        .bbox-visualizer .image-analysis-container { position: relative; line-height: 0; }
        .bbox-visualizer .damage-image { max-width: 100%; max-height: 100%; object-fit: contain; display: block; }
        .bbox-visualizer .damage-box { position: absolute; border: 3px solid red; pointer-events: none; background: rgba(255,0,0,0.2); }
        .bbox-visualizer .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .bbox-visualizer textarea, .bbox-visualizer input, .bbox-visualizer select { width: 100%; background-color: #111827; border: 1px solid #374151; border-radius: 0.25rem; padding: 0.5rem; color: #d1d5db; }
        .bbox-visualizer button { background-color: #1e40af; color: white; padding: 0.5rem 0.75rem; border-radius: 0.25rem; cursor: pointer; margin-right: 0.5rem; font-size: 0.75rem; }
        .bbox-visualizer .bbox-list { border: 1px solid #374151; max-height: 200px; overflow-y: auto; }
        .bbox-visualizer .bbox-item { padding: 0.5rem; border-bottom: 1px solid #374151; display: flex; justify-content: space-between; font-size: 0.75rem; }
        .bbox-visualizer .bbox-item-info strong { color: #60a5fa; }
        .bbox-visualizer .bbox-item button { background-color: #991b1b; padding: 0.25rem 0.5rem; }
    </style>
</head>
<body class="bg-black text-gray-300 font-mono">
    <div class="bg-gif"></div>

    <div class="flex min-h-screen">
        <div class="w-40 bg-black/90 backdrop-blur-sm border-r border-gray-800 p-2">
            <div class="mb-6">
                <h1 class="text-sm font-bold text-blue-400">$ devtools</h1>
                <p class="text-xs text-gray-400 mt-1">v0.0.1</p>
            </div>
            <nav class="space-y-1">
                <div class="text-xs text-gray-600 uppercase tracking-wider mb-2">Tools</div>
                <a href="#" class="sidebar-link block py-1 px-2 text-xs text-gray-400 rounded" data-tool="todo">
                    todo-list
                </a>
                <a href="#" class="sidebar-link block py-1 px-2 text-xs text-gray-400 rounded" data-tool="json">
                    json-formatter
                </a>
                <a href="#" class="sidebar-link block py-1 px-2 text-xs text-gray-400 rounded" data-tool="bbox">
                    bbox-visualizer
                </a>
                <a href="#" class="sidebar-link block py-1 px-2 text-xs text-gray-400 rounded" data-tool="timestamp">
                    timestamp-generator
                </a>
            </nav>
        </div>

        <div class="flex-1 p-3">
                <div id="home-content" class="bg-black/80 backdrop-blur-sm rounded-lg p-4 border border-gray-800">
                    <div class="mb-4">
                        <h2 class="text-lg font-bold text-blue-400 mb-2">DevTools Toolkit</h2>
                        <p class="text-gray-500 text-sm">Select a tool from the sidebar</p>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-gray-900/50 p-3 rounded border-l-4 border-blue-400 text-xs">
                            <div class="text-blue-400">‚Ä¢ todo-list</div>
                            <div class="text-blue-400">‚Ä¢ json-formatter</div>
                            <div class="text-blue-400">‚Ä¢ bbox-visualizer</div>
                            <div class="text-blue-400">‚Ä¢ timestamp-generator</div>
                        </div>
                    </div>
                </div>
                <div id="tool-content" class="hidden"></div>
        </div>
    </div>

    <div id="gif-window" class="fixed top-20 right-20 w-80 z-50 bg-gray-900 border border-gray-600 rounded-lg shadow-2xl flex flex-col">
        <div id="window-header" class="bg-gray-800 px-3 py-1 rounded-t-lg cursor-move flex items-center justify-between no-select flex-shrink-0">
            <span class="text-xs text-gray-400 flex items-center"><span class="mr-2">üìÅ</span>system.gif</span>
            <div class="flex items-center">
                <button onclick="toggleGifSelector()" class="w-6 h-6 bg-blue-600 hover:bg-blue-700 flex items-center justify-center text-white text-xs mr-1">‚öô</button>
                <button onclick="minimizeGifWindow()" class="w-6 h-6 bg-gray-700 hover:bg-gray-600 flex items-center justify-center text-white text-xs mr-1">‚àí</button>
                <button onclick="closeGifWindow()" class="w-6 h-6 bg-red-600 hover:bg-red-700 flex items-center justify-center text-white text-xs">√ó</button>
            </div>
        </div>
        <div id="window-content" class="p-2 flex-grow overflow-auto"><img src="gifs/a.gif" alt="System" class="w-full h-full object-cover rounded border border-gray-700"></div>
        <div class="resize-handle-n absolute top-0 left-1/2 -translate-x-1/2 w-full h-1"></div><div class="resize-handle-s absolute bottom-0 left-1/2 -translate-x-1/2 w-full h-1"></div><div class="resize-handle-e absolute right-0 top-1/2 -translate-y-1/2 w-1 h-full"></div><div class="resize-handle-w absolute left-0 top-1/2 -translate-y-1/2 w-1 h-full"></div><div class="resize-handle-ne absolute top-0 right-0 w-3 h-3"></div><div class="resize-handle-nw absolute top-0 left-0 w-3 h-3"></div><div class="resize-handle-se absolute bottom-0 right-0 w-3 h-3"></div><div class="resize-handle-sw absolute bottom-0 left-0 w-3 h-3"></div>
    </div>

    <div id="taskbar" class="fixed bottom-0 left-0 right-0 h-10 bg-gray-900/95 backdrop-blur-sm border-t border-gray-700 flex items-center px-2">
        <div id="taskbar-items" class="flex space-x-2"></div>
    </div>

    <script>
        const tools = {
            todo: `<div class="bg-black/80 backdrop-blur-sm rounded-lg p-4 border border-gray-800 h-full flex flex-col"><div class="flex justify-between items-center mb-4"><div><h2 class="text-lg font-bold text-blue-400">todo-list</h2><p class="text-xs text-gray-600">Organize your tasks</p></div><button onclick="clearAllTasks()" class="px-2 py-1 bg-red-800 text-white text-xs rounded hover:bg-red-900">CLEAR ALL</button></div><div class="flex-grow max-w-5xl w-full mx-auto"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 h-full"><div class="kanban-column bg-gray-900/50 p-2 rounded" data-column-id="todo" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)"><h3 class="font-bold text-sm text-blue-400 mb-3 p-1 border-t-4 border-blue-400">TODO</h3><div class="task-list space-y-2" id="todo-tasks"></div></div><div class="kanban-column bg-gray-900/50 p-2 rounded" data-column-id="in_progress" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)"><h3 class="font-bold text-sm text-yellow-400 mb-3 p-1 border-t-4 border-yellow-400">IN PROGRESS</h3><div class="task-list space-y-2" id="in_progress-tasks"></div></div><div class="kanban-column bg-gray-900/50 p-2 rounded" data-column-id="done" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)"><h3 class="font-bold text-sm text-green-400 mb-3 p-1 border-t-4 border-green-400">DONE</h3><div class="task-list space-y-2" id="done-tasks"></div></div></div></div><div class="mt-4 flex max-w-5xl w-full mx-auto"><input type="text" id="new-task-input" placeholder="Nova tarefa..." class="flex-grow p-2 bg-black/50 border border-gray-700 rounded-l text-xs font-mono text-gray-300 focus:border-blue-600 focus:outline-none"><button onclick="addNewTask()" class="px-3 py-2 bg-blue-800 text-white text-xs rounded-r hover:bg-blue-900">ADD</button></div></div>`,
            json: `<div class="bg-black/80 backdrop-blur-sm rounded-lg p-4 border border-gray-800"><div class="mb-3"><h2 class="text-lg font-bold text-blue-400">json-formatter</h2><p class="text-xs text-gray-600">Format and validate JSON</p></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-3"><div><label class="block text-xs text-gray-500 mb-1">INPUT</label><textarea id="json-input" placeholder='{"key": "value"}' class="w-full h-48 p-2 bg-black/50 border border-gray-700 rounded text-xs font-mono text-gray-300 focus:border-blue-600 focus:outline-none"></textarea><div class="mt-2 space-x-2"><button onclick="formatJson()" class="px-2 py-1 bg-blue-800 text-white text-xs rounded hover:bg-blue-900">FORMAT</button><button onclick="minifyJson()" class="px-2 py-1 bg-gray-800 text-white text-xs rounded hover:bg-gray-900">MINIFY</button></div></div><div><label class="block text-xs text-gray-500 mb-1">OUTPUT</label><textarea id="json-output" readonly class="w-full h-48 p-2 bg-black/80 border border-gray-700 rounded text-xs font-mono text-blue-400"></textarea><button onclick="copyText('json-output')" class="mt-2 px-2 py-1 bg-blue-700 text-white text-xs rounded hover:bg-blue-800">COPY</button></div></div></div>`,
            bbox: `<div class="bg-black/80 backdrop-blur-sm rounded-lg p-4 border border-gray-800 h-full flex flex-col bbox-visualizer"><h2 class="text-lg font-bold text-blue-400 mb-2">bbox-visualizer</h2><div class="controls-grid flex-grow"><div class="image-section flex flex-col"><div class="mb-2"><input id="bboxFileInput" type="file" accept="image/*" /><button id="bboxClearBtn">Limpar</button><button id="bboxTestBtn">Teste</button></div><div class="image-display-box flex-grow"><div class="image-analysis-container" id="bboxImageContainer"><img id="bboxDamageImage" class="damage-image" style="display:none;" /><div id="bboxOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div></div></div></div><div class="controls"><div class="mb-2"><label class="text-xs text-gray-500">Modo:</label><select id="bboxMode"><option value="redamage">JSON Redamage</option><option value="manual">Manual</option></select></div><div id="bboxRedamageRow" class="mb-2"><label class="text-xs text-gray-500">Cole o JSON da Redamage:</label><textarea id="bboxRedamageJson"></textarea><button id="bboxLoadRedamage" class="mt-1">Carregar Bboxes</button></div><div id="bboxManualRow" style="display:none;" class="mb-2"><label class="text-xs text-gray-500">Coordenadas:</label><input id="bboxManualBox" placeholder="[x1,y1,x2,y2]" class="mb-1" /><label class="text-xs text-gray-500">Label:</label><input id="bboxManualInfo" placeholder="label" /><button id="bboxAddManual" class="mt-1">Adicionar</button></div><div class="mb-2"><label class="text-xs font-bold">Bboxes Detectados</label><div id="bboxBoxesList" class="bbox-list mt-1"></div></div></div></div></div>`,
            timestamp: `<div class="bg-black/80 backdrop-blur-sm rounded-lg p-4 border border-gray-800"><div class="mb-4"><h2 class="text-lg font-bold text-blue-400">Timestamp Generator - ObjectID</h2><p class="text-xs text-gray-600">Gere ObjectIDs do MongoDB a partir de um per√≠odo.</p></div><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-xs text-gray-500 mb-1">Data de In√≠cio</label><input type="date" id="ts-start-date" class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs"></div><div><label class="block text-xs text-gray-500 mb-1">Hora de In√≠cio</label><input type="time" id="ts-start-time" step="1" class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs"></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-xs text-gray-500 mb-1">Data Final</label><input type="date" id="ts-end-date" class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs"></div><div><label class="block text-xs text-gray-500 mb-1">Hora Final</label><input type="time" id="ts-end-time" step="1" class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs"></div></div><div class="mt-4"><button id="ts-generate-btn" class="px-3 py-2 bg-blue-800 text-white text-xs rounded hover:bg-blue-900">GERAR</button></div><div class="mt-4 space-y-2"><div><label class="block text-xs text-gray-500 mb-1">Start ID</label><div class="flex"><input id="ts-start-id-output" readonly class="w-full p-2 bg-black/80 border border-gray-700 rounded-l text-xs font-mono text-blue-400"><button onclick="copyText('ts-start-id-output')" class="px-2 bg-blue-700 rounded-r text-xs">COPY</button></div></div><div><label class="block text-xs text-gray-500 mb-1">End ID</label><div class="flex"><input id="ts-end-id-output" readonly class="w-full p-2 bg-black/80 border border-gray-700 rounded-l text-xs font-mono text-blue-400"><button onclick="copyText('ts-end-id-output')" class="px-2 bg-blue-700 rounded-r text-xs">COPY</button></div></div></div></div></div>`
        };

        // --- State Variables ---
        let isDragging = false, isResizing = false, resizeType = '', windowState = 'normal';
        let dragOffset = { x: 0, y: 0 }, initialRect = {}, initialMouse = { x: 0, y: 0 };
        let currentGif = localStorage.getItem('selectedGif') || 'gifs/a.gif';
        const availableGifs = ['a.gif', 'akira 2.gif', 'akira.gif', 'ghibli 2.gif', 'ghibli.gif', 'lofi.gif', 'wave.gif'];
        let bboxData = [];
        let tasks = JSON.parse(localStorage.getItem('todoTasks')) || { todo: [], in_progress: [], done: [] };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            loadGifWindowState();
            updateGifDisplay();
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tool = link.dataset.tool;
                    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    showTool(tool);
                });
            });
            const header = document.getElementById('window-header');
            header.addEventListener('mousedown', startDrag);
            document.querySelectorAll('[class*="resize-handle-"]').forEach(handle => {
                handle.addEventListener('mousedown', (e) => {
                    e.preventDefault(); e.stopPropagation();
                    const classes = e.target.className.split(' ');
                    resizeType = classes.find(c => c.startsWith('resize-handle-')).replace('resize-handle-', '');
                    startResize(e);
                });
            });
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', stopDragResize);
            window.addEventListener('resize', bboxRenderBboxes);
        });

        function showTool(tool) {
            document.getElementById('home-content').classList.add('hidden');
            const content = document.getElementById('tool-content');
            content.innerHTML = tools[tool] || '<div class="text-red-400">Tool not found</div>';
            content.classList.remove('hidden');
            if (tool === 'todo') {
                document.getElementById('new-task-input').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        addNewTask();
                    }
                });
                renderTasks();
            }
            if (tool === 'bbox') initBboxVisualizer();
            if (tool === 'timestamp') initTimestampGenerator();
        }

        // --- Timestamp Generator Functions ---
        function initTimestampGenerator() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ts-start-date').value = today;
            document.getElementById('ts-end-date').value = today;
            document.getElementById('ts-start-time').value = '00:00:00';
            document.getElementById('ts-end-time').value = '23:59:59';
            document.getElementById('ts-generate-btn').addEventListener('click', generateObjectIds);
        }
        function objectIdFromDate(date) { const timestamp = Math.floor(date.getTime() / 1000).toString(16); return timestamp + '0000000000000000'; }
        function generateObjectIds() {
            const startDate = document.getElementById('ts-start-date').value, startTime = document.getElementById('ts-start-time').value;
            const endDate = document.getElementById('ts-end-date').value, endTime = document.getElementById('ts-end-time').value;
            const startDateTime = new Date(`${startDate}T${startTime}`), endDateTime = new Date(`${endDate}T${endTime}`);
            document.getElementById('ts-start-id-output').value = objectIdFromDate(startDateTime);
            document.getElementById('ts-end-id-output').value = objectIdFromDate(endDateTime);
        }

        // --- BBox Visualizer Functions ---
        function initBboxVisualizer() {
            bboxData = [];
            document.getElementById('bboxTestBtn').addEventListener('click', () => {
                const img = document.getElementById('bboxDamageImage');
                if (!img.complete || img.naturalWidth === 0) { alert('Carregue uma imagem primeiro!'); return; }
                bboxData = [{ bounding_box: [10, 10, 100, 100], category: 'teste', location: 'canto', score: 1.0, color: [255, 0, 0] }];
                bboxRefreshList(); bboxRenderBboxes();
            });
            document.getElementById('bboxMode').addEventListener('change', (e) => {
                document.getElementById('bboxManualRow').style.display = e.target.value === 'manual' ? 'block' : 'none';
                document.getElementById('bboxRedamageRow').style.display = e.target.value === 'redamage' ? 'block' : 'none';
            });
            document.getElementById('bboxAddManual').addEventListener('click', () => {
                const txt = document.getElementById('bboxManualBox').value.trim(); if (!txt) return;
                try {
                    const coords = JSON.parse(txt);
                    if (Array.isArray(coords) && coords.length === 4) {
                        const label = document.getElementById('bboxManualInfo').value.trim() || 'manual';
                        bboxData.push({ bounding_box: coords, category: label, location: 'manual', score: 1.0, color: [255, 165, 0] });
                        bboxRefreshList(); bboxRenderBboxes();
                        document.getElementById('bboxManualBox').value = ""; document.getElementById('bboxManualInfo').value = "";
                    }
                } catch(err) { alert("Formato inv√°lido"); }
            });
            document.getElementById('bboxLoadRedamage').addEventListener('click', () => {
                const jsonText = document.getElementById('bboxRedamageJson').value.trim(); if (!jsonText) return;
                try {
                    const data = JSON.parse(jsonText);
                    if (!data.result || !Array.isArray(data.result)) { alert("JSON inv√°lido - esperado {result: [...]}"); return; }
                    bboxData = data.result.filter(item => item.bounding_box && Array.isArray(item.bounding_box) && item.bounding_box.length >= 4);
                    bboxRefreshList(); bboxRenderBboxes();
                    document.getElementById('bboxRedamageJson').value = "";
                } catch(err) { alert("Erro no JSON: " + err.message); }
            });
            document.getElementById('bboxClearBtn').addEventListener('click', () => { bboxData = []; bboxRefreshList(); bboxRenderBboxes(); });
            document.getElementById('bboxFileInput').addEventListener('change', (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const img = document.getElementById('bboxDamageImage');
                    img.onload = () => { img.style.display = 'block'; bboxRenderBboxes(); };
                    img.src = evt.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        function bboxRenderBboxes() {
            const overlay = document.getElementById('bboxOverlay'), img = document.getElementById('bboxDamageImage'), container = document.querySelector('.bbox-visualizer .image-display-box'), imgContainer = document.getElementById('bboxImageContainer');
            if (!img || !container || !imgContainer || !img.complete || img.naturalWidth === 0) { if(overlay) overlay.innerHTML = ''; return; }
            const scale = Math.min(container.clientWidth / img.naturalWidth, container.clientHeight / img.naturalHeight);
            const displayedWidth = img.naturalWidth * scale, displayedHeight = img.naturalHeight * scale;
            imgContainer.style.width = `${displayedWidth}px`; imgContainer.style.height = `${displayedHeight}px`;
            overlay.innerHTML = '';
            bboxData.forEach((item, idx) => {
                if (!item.bounding_box || item.bounding_box.length !== 4) return;
                let [x1, y1, x2, y2] = item.bounding_box;
                let borderColor = '#ff0000', backgroundColor = 'rgba(255, 0, 0, 0.3)';
                if (item.color && Array.isArray(item.color) && item.color.length === 3) {
                    const [r, g, b] = item.color;
                    borderColor = `rgb(${r}, ${g}, ${b})`; backgroundColor = `rgba(${r}, ${g}, ${b}, 0.3)`;
                }
                const div = document.createElement('div');
                div.className = 'damage-box';
                div.style.left = `${x1 * scale}px`; div.style.top = `${y1 * scale}px`;
                div.style.width = `${(x2 - x1) * scale}px`; div.style.height = `${(y2 - y1) * scale}px`;
                div.style.border = `3px solid ${borderColor}`; div.style.backgroundColor = backgroundColor;
                div.title = `${item.category} - ${item.location} (${(item.score*100).toFixed(1)}%)`;
                div.innerHTML = `<div style="color:white;font-size:12px;padding:2px;">${idx}</div>`;
                overlay.appendChild(div);
            });
        }
        function bboxRefreshList() {
            const boxesList = document.getElementById('bboxBoxesList'); if(!boxesList) return;
            boxesList.innerHTML = "";
            bboxData.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = "bbox-item";
                div.innerHTML = `<div class="bbox-item-info"><strong>${item.category || 'N/A'}</strong> - ${item.location || 'N/A'}</div><button onclick="bboxRemoveBox(${i})">X</button>`;
                boxesList.appendChild(div);
            });
        }
        function bboxRemoveBox(i) { bboxData.splice(i, 1); bboxRefreshList(); bboxRenderBboxes(); }

        // --- ToDo List Functions ---
        function saveTasks() { localStorage.setItem('todoTasks', JSON.stringify(tasks)); }
        function renderTasks() {
            Object.keys(tasks).forEach(columnId => {
                const columnElement = document.getElementById(`${columnId}-tasks`);
                if(columnElement) {
                    columnElement.innerHTML = '';
                    tasks[columnId].forEach((taskText, index) => {
                        const taskCard = document.createElement('div');
                        taskCard.className = 'task-card bg-gray-800 p-2 rounded text-xs';
                        taskCard.setAttribute('draggable', true);
                        taskCard.dataset.taskId = `${columnId}-${index}`;
                        taskCard.addEventListener('dragstart', handleDragStart);
                        taskCard.addEventListener('dblclick', (e) => editTask(e.currentTarget, columnId, index));

                        const taskTextSpan = document.createElement('span');
                        taskTextSpan.textContent = taskText;
                        taskCard.appendChild(taskTextSpan);

                        const deleteBtn = document.createElement('div');
                        deleteBtn.className = 'delete-btn';
                        deleteBtn.innerHTML = '&times;';
                        deleteBtn.onclick = (e) => { e.stopPropagation(); deleteTask(columnId, index); };
                        taskCard.appendChild(deleteBtn);

                        columnElement.appendChild(taskCard);
                    });
                }
            });
        }
        function deleteTask(columnId, index) {
            tasks[columnId].splice(index, 1);
            saveTasks();
            renderTasks();
        }
        function editTask(cardElement, columnId, index) {
            const currentText = tasks[columnId][index];
            cardElement.setAttribute('draggable', false);
            cardElement.innerHTML = ''; // Clear the card
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'w-full bg-gray-700 text-white text-xs p-1 rounded focus:outline-none';
            input.addEventListener('blur', () => saveEdit(columnId, index, input.value));
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') input.blur();
                if (e.key === 'Escape') renderTasks(); // Cancel edit
            });
            cardElement.appendChild(input);
            input.focus();
        }
        function saveEdit(columnId, index, newText) {
            if (newText.trim()) {
                tasks[columnId][index] = newText.trim();
                saveTasks();
            }
            renderTasks();
        }
        function addNewTask() { const input = document.getElementById('new-task-input'); if (input && input.value.trim() !== '') { tasks.todo.push(input.value.trim()); input.value = ''; saveTasks(); renderTasks(); } }
        function clearAllTasks() { tasks = { todo: [], in_progress: [], done: [] }; saveTasks(); renderTasks(); }
        function handleDragStart(event) { event.dataTransfer.setData('text/plain', event.target.dataset.taskId); }
        function handleDragOver(event) { event.preventDefault(); event.currentTarget.classList.add('drag-over'); }
        function handleDragLeave(event) { event.currentTarget.classList.remove('drag-over'); }
        function handleDrop(event) {
            event.preventDefault(); event.currentTarget.classList.remove('drag-over');
            const taskId = event.dataTransfer.getData('text/plain');
            const [sourceColumnId, taskIndex] = taskId.split('-');
            const targetColumnId = event.currentTarget.dataset.columnId;
            if (sourceColumnId !== targetColumnId) {
                const taskText = tasks[sourceColumnId].splice(parseInt(taskIndex), 1)[0];
                tasks[targetColumnId].push(taskText);
                saveTasks(); renderTasks();
            }
        }

        // --- Core Functions ---
        function formatJson(){const i=document.getElementById('json-input').value,o=document.getElementById('json-output');try{o.value=JSON.stringify(JSON.parse(i),null,2)}catch(t){o.value="ERROR: Invalid JSON"}}
        function minifyJson(){const i=document.getElementById('json-input').value,o=document.getElementById('json-output');try{o.value=JSON.stringify(JSON.parse(i))}catch(t){o.value="ERROR: Invalid JSON"}}
        function copyText(t){const e=document.getElementById(t);e.select(),document.execCommand("copy");const o=event.target,n=o.textContent;o.textContent="COPIED!",setTimeout(()=>{o.textContent=n},1e3)}

        // --- GIF Window Functions ---
        function saveGifWindowState(){const t=document.getElementById("gif-window").getBoundingClientRect(),e={top:t.top,left:t.left,width:t.width,height:t.height};localStorage.setItem("gifWindowState",JSON.stringify(e))}
        function loadGifWindowState(){const t=localStorage.getItem("gifWindowState");if(t){const e=JSON.parse(t),o=document.getElementById("gif-window");o.style.top=`${e.top}px`,o.style.left=`${e.left}px`,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`}}
        function startDrag(t){isDragging=!0;const e=document.getElementById("gif-window").getBoundingClientRect();dragOffset.x=t.clientX-e.left,dragOffset.y=t.clientY-e.top}
        function startResize(t){isResizing=!0,document.body.classList.add("resizing","no-select"),initialRect=document.getElementById("gif-window").getBoundingClientRect(),initialMouse.x=t.clientX,initialMouse.y=t.clientY}
        function handleMouseMove(t){const e=document.getElementById("gif-window"),o=document.getElementById("taskbar").offsetHeight;if(isDragging){let n=t.clientX-dragOffset.x,i=t.clientY-dragOffset.y;const d=window.innerWidth-e.offsetWidth,s=window.innerHeight-e.offsetHeight-o;n=Math.max(0,Math.min(n,d)),i=Math.max(0,Math.min(i,s)),e.style.left=`${n}px`,e.style.top=`${i}px`}if(isResizing){const n=t.clientX-initialMouse.x,i=t.clientY-initialMouse.y;let d=200,s=150,l=initialRect.width,a=initialRect.height,r=initialRect.left,c=initialRect.top;resizeType.includes("e")&&(l=initialRect.width+n),resizeType.includes("s")&&(a=initialRect.height+i),resizeType.includes("w")&&(l=initialRect.width-n,r=initialRect.left+n),resizeType.includes("n")&&(a=initialRect.height-i,c=initialRect.top+i),l<d&&(l=d),a<s&&(a=s),r<0&&(r=0),c<0&&(c=0),r+l>window.innerWidth&&(l=window.innerWidth-r),c+a>window.innerHeight-o&&(a=window.innerHeight-o-c),e.style.width=`${l}px`,e.style.height=`${a}px`,e.style.left=`${r}px`,e.style.top=`${c}px`}}
        function stopDragResize(){(isDragging||isResizing)&&saveGifWindowState(),isDragging=!1,isResizing=!1,document.body.classList.remove("resizing","no-select")}
        function closeGifWindow(){document.getElementById("gif-window").style.display="none"}
        function minimizeGifWindow(){const t=document.getElementById("gif-window"),e=document.getElementById("taskbar-items");"minimized"===windowState?(t.style.display="flex",e.innerHTML="",windowState="normal"):(t.style.display="none",e.innerHTML='<button onclick="minimizeGifWindow()" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-xs text-gray-300 rounded flex items-center"><span class="mr-1">üìÅ</span>system.gif</button>',windowState="minimized")}
        function updateGifDisplay(){const t=document.querySelector("#window-content img"),e=document.querySelector(".bg-gif");t&&(t.src=currentGif),e.style.backgroundImage=`url('${currentGif}')`}
        function toggleGifSelector(){const t=document.getElementById("window-content");if(t.querySelector("#gif-grid"))t.innerHTML=`<img src="${currentGif}" alt="System" class="w-full h-full object-cover rounded border border-gray-700">`;else{const e=availableGifs.map((t=>`<img src="gifs/${t}" class="w-full h-16 object-cover rounded cursor-pointer hover:opacity-80 border border-gray-600" onclick="selectGif('gifs/${t}')">`)).join("");t.innerHTML=`<div id="gif-grid" class="grid grid-cols-3 gap-2">${e}</div>`}}
        function selectGif(t){currentGif=t,localStorage.setItem("selectedGif",t);const e=document.getElementById("window-content");e.innerHTML=`<img src="${currentGif}" alt="System" class="w-full h-full object-cover rounded border border-gray-700">`,updateGifDisplay()}
    </script>
</body>
</html>